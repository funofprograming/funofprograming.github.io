<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Application Context</title>
<meta content="Application Context" property="og:title">
<meta content="Application Context" name="title">
<meta content="Application Context" property="og:site_name">
<meta content=" " name="description">
<meta content=" " property="og:description">

<meta property="og:type" content="website">
<link rel="canonical" href="https://funofprograming.github.io/projects/01-application-context-util/">
<meta name="language" content="en">
<meta name="locale" content="en_IN">
<meta property="og:locale" content="en_IN">
<meta name="generator" content="Eleventy v3.0.0"> 
<script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","description":"Fun of coding with interesting projects and problems","headline":"Fun of Programing - Fun of coding with interesting projects and problems","name":"Fun of Programing","url":"https://funofprograming.github.io/projects/01-application-context-util/"}</script>
<meta name="generator" content="Eleventy v3.0.0">
<meta name="color-scheme" content="light dark">
<link rel="stylesheet" href="/static/css/index.css">
<link rel="stylesheet" href="/static/css/jquery-ui.min.css">
<link rel="stylesheet" href="/static/css/jquery-ui.structure.min.css">
<link rel="stylesheet" href="/static/css/jquery-ui.theme.min.css">
<link rel="stylesheet" href="/static/css/prism.css">
<link rel="stylesheet" href="/static/css/pico.min.css">
<link rel="stylesheet" href="/static/css/message-box.css">
<script type="module">
    import "/static/js/is-land.js";
</script>
<script type="text/javascript" src="/static/js/lamp.js"></script>
<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/jquery-ui.min.js"></script>
<script type="text/javascript" src="/static/js/prism.js"></script>

<style>.skip-to-content{position:absolute;top:-100px;left:100px;background-color:#4b4e54;color:#fff;padding:10px;text-decoration:none;z-index:999;transition:top .3s}.skip-to-content:focus{top:0}.snts{counter-reset:section}.snt{counter-reset:subsection}.snt::before{counter-increment:section;content:"" counter(section)}.snls{counter-reset:section}.snl{counter-reset:subsection}.snl::before{counter-increment:section;content:"" counter(section)}sup{padding-right:8px}.p-5{padding-top:25px}img{max-width:100%;padding-top:5px;padding-bottom:12px}iframe{height:auto;width:100%;aspect-ratio:16/9;padding-top:5px;padding-bottom:12px}</style>


</head>

<body class="line-numbers match-braces">
    <div style="text-align: center; font-size: xx-large;">
        <header class="container">
            <hgroup>
                <h1 id="fun-of-programing">
                    
                    <a href="https://funofprograming.github.io">Fun of Programing</a>
                    
                </h1>
            </hgroup>
        </header>
    </div>
    <navbar>
  <nav class="container-fluid">
    <div><a href="/articles/">Articles</a></div><div><a href="/projects/">Projects</a></div><div><a href="/about/">About</a></div><div><a href="/search/">Search</a></div>
  </nav>
</navbar>
<hr>

<main id="skip">
<header class="container">
<hgroup>
<h1 id="application-context"><a href="/projects/01-application-context-util/">Application Context</a></h1>
<h2 id=""><em> </em></h2>
</hgroup>
</header>
<div class="container snls snts">
<heading-anchors>
<div class="container">
    <p>
    <a href="/tags/projects/"><small>projects</small></a> ,
    <a href="/tags/application-context-util/"><small>application-context-util</small></a> ,
    <a href="/tags/kotlin/"><small>Kotlin</small></a> ,
    <a href="/tags/java/"><small>Java</small></a></p>
</div>
<h2 id="overview">Overview</h2>
<p>Application context util is a simple kotlin based library that provides for setting up and using simple key/value context in our application.
Sure key/value pairs can be managed by a simple Map but then passing that map all around the code methods is very cumbersome.</p>
<p>What this library aims is to enable to create and access context anywhere in code statically without needing to pass around in methods meanwhile providing thread/coroutine safety as well.</p>
<p>Central interface of this library is <strong>ApplicationContext</strong></p>
<p>This allows to store values against named Keys which also store value type information</p>
<h2 id="usage">Usage</h2>
<h3 id="maven-dependency">Maven dependency</h3>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;io.github.funofprograming&lt;/groupId&gt;
    &lt;artifactId&gt;application-context-util&lt;/artifactId&gt;
    &lt;version&gt;LATEST&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4 id="versions">Versions</h4>
<p>Check for latest versions here: <a href="https://github.com/funofprograming/application-context-util/releases">Releases</a></p>
<h3 id="code">Code</h3>
<p>Globally available context in all threads/coroutine</p>
<p></p><div>
<is-land on:visible="" on:idle="">
<script type="text/javascript">
$( function() {
$( '#acuTabs1' ).tabs();
} );
</script>
<div id="acuTabs1">
<ul><p></p>
<p><li><a href="#acu-kotlin1">Kotlin</a></li></p>
<p><li><a href="#acu-java1">Java</a></li></p>
<p></p></ul><p></p>
<p></p><div id="acu-kotlin1"><p></p>
<pre><code class="language-kotlin">import io.github.funofprograming.context.impl.*

val contextName: String = &quot;TestGlobalApplicationContext&quot;
val valueSetInThread1 = &quot;Value T1&quot;
val validKey: Key&lt;String&gt; = Key.of(&quot;ValidKey&quot;, String::class.java)

val def1 = launch {
    val globalContext = getGlobalContext(contextName)
    globalContext?.add(validKey, valueSetInThread1)
}

delay(1000)

val def2 = async {
    val globalContext = getGlobalContext(contextName)
    return@async globalContext?.fetch(validKey)
}


println(valueSetInThread1 == def2.await())
</code></pre>
<p></p></div><p></p>
<p></p><div id="acu-java1"><p></p>
<pre><code class="language-java">import io.github.funofprograming.context.impl.*;
import java.util.concurrent.*;

public class TestGlobalApplicationContext{
    public static void main(String[] args) {
        String contextName = &quot;TestGlobalApplicationContext&quot;;
        Key&lt;String&gt; validKey = Key.Companion.of(&quot;ValidKey&quot;, String.class);
        ThreadPoolExecutor executorService = new ThreadPoolExecutor(1, 1, 1L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());
        String valueSetInThread1 = &quot;Value T1&quot;;

        CompletableFuture.runAsync(()-&gt;{
            ApplicationContext globalContext = ApplicationContextHoldersKt.getGlobalContext(contextName);
            globalContext.add(validKey, valueSetInThread1);
        });

        Thread.sleep(1000);

        CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(()-&gt;{
            ApplicationContext globalContext = ApplicationContextHoldersKt.getGlobalContext(contextName);
            return globalContext.fetch(validKey);
        });
        Thread.sleep(1000);
        
        System.out.println(valueSetInThread1.equals(future2.get()));
    }    
}
</code></pre>
<p></p></div><p></p>
<p></p></div>
</is-land>
</div><p></p>
<p>Above snippet prints:</p>
<pre><code class="no-line-numbers language-text">true
</code></pre>
<p>ThreadLocal available context in current thread/coroutine</p>
<p></p><div>
<is-land on:visible="" on:idle="">
<script type="text/javascript">
$( function() {
$( '#acuTabs2' ).tabs();
} );
</script>
<div id="acuTabs2">
<ul><p></p>
<p><li><a href="#acu-kotlin2">Kotlin</a></li></p>
<p><li><a href="#acu-java2">Java</a></li></p>
<p></p></ul><p></p>
<p></p><div id="acu-kotlin2"><p></p>
<pre><code class="language-kotlin">import io.github.funofprograming.context.impl.*

val contextName: String = &quot;TestThreadLocalApplicationContext&quot;
val valueSetInThread1 = &quot;Value T1&quot;
val validKey: Key&lt;String&gt; = Key.of(&quot;ValidKey&quot;, String::class.java)

val cs1 = initCoroutineScopeForApplicationContext() //notice the initialization of coroutine scope in case we plan to use a thread local context inside a coroutine
val def1 = cs1.async {
    val localContext = getThreadLocalContext(contextName)
    localContext?.add(validKey, valueSetInThread1)
    return@async getThreadLocalContext(contextName)?.fetch(validKey)
}

delay(1000)
val cs2 = initCoroutineScopeForApplicationContext() //notice the initialization of coroutine scope in case we plan to use a thread local context inside a coroutine
val def2 = cs2.async {
    val localContext = getThreadLocalContext(contextName)
    return@async localContext?.fetch(invalidKey)
}

println(def2.await() == null)
println(valueSetInThread1 == def1.await())
</code></pre>
<p></p></div><p></p>
<p></p><div id="acu-java2"><p></p>
<pre><code class="language-java">import io.github.funofprograming.context.impl.*;
import java.util.concurrent.*;

public class TestThreadLocalApplicationContext{
    public static void main(String[] args) {
        String contextName = &quot;TestThreadLocalApplicationContext&quot;;
        Key&lt;String&gt; validKey = Key.Companion.of(&quot;ValidKey&quot;, String.class);
        ThreadPoolExecutor executorService = new ThreadPoolExecutor(1, 1, 1L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());
        String valueSetInThread1 = &quot;Value T1&quot;;

        CompletableFuture&lt;String&gt; future1 = CompletableFuture.supplyAsync(()-&gt;{
            ApplicationContext localContext = ApplicationContextHoldersKt.getThreadLocalContext(contextName);
            localContext.add(validKey, valueSetInThread1);
            return ApplicationContextHoldersKt.getThreadLocalContext(contextName).fetch(validKey);
        }, executorService);

        Thread.sleep(1000);

        CompletableFuture&lt;String&gt; future2 = CompletableFuture.supplyAsync(()-&gt;{
            ApplicationContext localContext = ApplicationContextHoldersKt.getThreadLocalContext(contextName);
            return localContext.fetch(validKey);
        }, executorService);

        System.out.println(future2.get() == null);
        System.out.println(valueSetInThread1.equals(future1.get()));
    }
}
</code></pre>
<p></p></div><p></p>
<p></p></div>
</is-land>
</div><p></p>
<p>Above snippet prints:</p>
<pre><code class="no-line-numbers language-text">true
true
</code></pre>
<p>Also, the context supports restricting keys of context to some predetermined set as follows:</p>
<p></p><div>
<is-land on:visible="" on:idle="">
<script type="text/javascript">
$( function() {
$( '#acuTabs3' ).tabs();
} );
</script>
<div id="acuTabs3">
<ul><p></p>
<p><li><a href="#acu-kotlin3">Kotlin</a></li></p>
<p><li><a href="#acu-java3">Java</a></li></p>
<p></p></ul><p></p>
<p></p><div id="acu-kotlin3"><p></p>
<pre><code class="language-kotlin">import io.github.funofprograming.context.impl.*

val contextName: String = &quot;TestApplicationContext&quot;
val validKey: Key&lt;String&gt; = Key.of(&quot;ValidKey&quot;, String::class.java)
val invalidKey: Key&lt;String&gt; = Key.of(&quot;InvalidKey&quot;, String::class.java)
val permittedKeys: Set&lt;Key&lt;*&gt;&gt; = setOf(validKey)

val globalContext = getGlobalContext(contextName, permittedKeys)
globalContext?.add(validKey, valueSetInThread1)
globalContext?.fetch(invalidKey) //throws InvalidKeyException here since invalidKey is not part of permittedKeys

val localContext = getThreadLocalContext(contextName, permittedKeys)
localContext?.add(validKey, valueSetInThread1)
localContext?.fetch(invalidKey) //throws InvalidKeyException here since invalidKey is not part of permittedKeys
</code></pre>
<p></p></div><p></p>
<p></p><div id="acu-java3"><p></p>
<pre><code class="language-java">import io.github.funofprograming.context.impl.*;
import java.util.concurrent.*;

public class TestApplicationContext{
    public static void main(String[] args) {
        String contextName = &quot;TestApplicationContext&quot;;
        Key&lt;String&gt; validKey = Key.Companion.of(&quot;ValidKey&quot;, String.class);
        String valueSetInThread1 = &quot;Value T1&quot;;
        Key&lt;String&gt; invalidKey = Key.Companion.of(&quot;InvalidKey&quot;, String.class);
        Set&lt;Key&lt;?&gt;&gt; permittedKeys = new HashSet&lt;&gt;(Arrays.asList(validKey));

        ApplicationContext globalContext = ApplicationContextHoldersKt.getGlobalContext(contextName, permittedKeys);
        globalContext.add(validKey, valueSetInThread1);
        globalContext.fetch(invalidKey); //throws InvalidKeyException here since invalidKey is not part of permittedKeys

        ApplicationContext localContext = ApplicationContextHoldersKt.getThreadLocalContext(contextName, permittedKeys);
        localContext.add(validKey, valueSetInThread1);
        localContext.fetch(invalidKey); //throws InvalidKeyException here since invalidKey is not part of permittedKeys
    }
}
</code></pre>
<p></p></div><p></p>
<p></p></div>
</is-land>
</div><p></p>
<h2 id="compatibility-matrix">Compatibility matrix</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Application Context Util</th>
<th style="text-align:center">Java</th>
<th style="text-align:center">Kotlin-Std</th>
<th style="text-align:center">Kotlin-Coroutines</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1.0.0</td>
<td style="text-align:center">21</td>
<td style="text-align:center">2.1.10</td>
<td style="text-align:center">1.10.1</td>
</tr>
</tbody>
</table>
<h2 id="license">License</h2>
<p>Application context util is is released under version 2.0 of the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License</a>.</p>
<h2 id="source">Source</h2>
<div><img src="/static/images/github-mark.png" loading="lazy" title="application-context-util" height="56px" ,="" width="50px"> <a href="https://github.com/funofprograming/application-context-util" class="primary">application-context-util</a></div>



<div>
<div class="container p-5">
<nav>


</nav>
</div>

</div>
<div>
    

<section>
<style>.utterances{ max-width: 1080px; }</style>
<script src="https://utteranc.es/client.js" repo="https://github.com/funofprograming/application-context-util" issue-term="og:title" label="fopcomments" theme="github-light" crossorigin="anonymous" async="">
</script>
<noscript>Please enable JavaScript to view the comments powered by Utterances.</noscript>
</section>


</div>

</heading-anchors>
</div>
</main>

<script type="text/javascript" defer="">
    $(function() {
        $("div.ui-tabs").tabs({
            activate: function( event, ui ) {
                var tabIndex = $(this).tabs('option', 'active');
                $("div.ui-tabs").tabs({active:tabIndex});
            }
        });
    });
    
</script>

    <hr>
    <footer>
        <p><em>Built with <a href="https://www.11ty.dev/">Eleventy v3.0.0</a></em></p>
    </footer>
    
</body>

</html>